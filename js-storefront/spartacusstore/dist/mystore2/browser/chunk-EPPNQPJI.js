import{H as lt,M as Ct,m as mt}from"./chunk-PWBMBWIR.js";import{$ as at,E as et,Ka as ct,La as dt,Nb as ut,V as it,X as nt,Y as ot,_ as rt,e as z,ea as st,g as J,j as X,l as Z,na as pt,p as tt}from"./chunk-ABA734YC.js";import{Aa as E,Ac as V,Dd as G,Fa as y,Fb as h,Ga as x,Gb as I,Hb as S,Hc as U,I as b,Ke as K,Lb as B,Mb as N,Nb as M,R as _,Sa as D,Ta as o,Ua as l,Wa as q,Xb as c,Yb as d,Ye as W,cb as C,db as F,eb as r,gc as Q,je as H,kb as p,lb as f,mb as v,nb as R,ob as P,og as $,pg as Y,qb as g,sa as A,sb as T,sc as L,tb as a,v as k,va as O,vc as j,za as w}from"./chunk-FDYREMOD.js";function _t(e,u){if(e&1&&v(0,"cx-item-counter",9),e&2){let t=a(3);r("max",t.maxQuantity)("control",t.addToCartForm.get("quantity"))}}function yt(e,u){if(e&1&&(p(0,"span"),h(1),f()),e&2){let t=a(3);o(),I(t.getInventory())}}function xt(e,u){if(e&1&&(p(0,"div",5)(1,"label"),h(2),c(3,"cxTranslate"),f(),p(4,"div",6),C(5,_t,1,2,"cx-item-counter",7),p(6,"span",8),C(7,yt,2,1,"span",3),c(8,"async"),h(9),c(10,"cxTranslate"),c(11,"cxTranslate"),f()()()),e&2){let t=a(2);o(2),I(d(3,4,"addToCart.quantity")),o(3),r("ngIf",t.hasStock),o(2),r("ngIf",d(8,6,t.showInventory$)),o(2),S(" ",t.hasStock?d(10,8,"addToCart.inStock"):d(11,10,"addToCart.outOfStock"),"")}}function vt(e,u){}function gt(e,u){if(e&1){let t=g();R(0),C(1,vt,0,0,"ng-template",10),M("cxComponentRefChange",function(i){y(t);let m=a(2);return N(m.pickupOptionCompRef,i)||(m.pickupOptionCompRef=i),x(i)}),P()}if(e&2){let t=a(2);o(),r("cxOutlet",t.CartOutlets.ADD_TO_CART_PICKUP_OPTION),B("cxComponentRef",t.pickupOptionCompRef)}}function Tt(e,u){if(e&1&&(p(0,"span",14),v(1,"cx-icon",15),f()),e&2){let t=a(3);o(),r("type",t.iconTypes.REPEAT)}}function It(e,u){if(e&1&&(p(0,"button",11),C(1,Tt,2,1,"span",12),c(2,"cxTranslate"),p(3,"span",13),c(4,"cxTranslate"),c(5,"cxTranslate"),h(6),c(7,"cxTranslate"),f()()),e&2){let t,n,i=a(2);r("ngClass",i.options!=null&&i.options.displayAddToCart?"btn btn-tertiary":"btn btn-primary btn-block")("disabled",i.quantity<=0||i.quantity>i.maxQuantity),o(),r("ngIf",(i.options==null?null:i.options.addToCartString)===d(2,6,"addToCart.buyItAgain")),o(2),r("ngClass",(i.options==null?null:i.options.addToCartString)===d(4,8,"addToCart.buyItAgain")?"buyItAgainLink":""),F("aria-label",(t=i.options==null?null:i.options.addToCartString)!==null&&t!==void 0?t:d(5,10,"addToCart.addToCart")),o(3),S(" ",(n=i.options==null?null:i.options.addToCartString)!==null&&n!==void 0?n:d(7,12,"addToCart.addToCart")," ")}}function St(e,u){if(e&1){let t=g();p(0,"form",1),T("submit",function(){y(t);let i=a();return x(i.addToCart())}),C(1,xt,12,12,"div",2)(2,gt,2,2,"ng-container",3)(3,It,8,14,"button",4),f()}if(e&2){let t=a();r("formGroup",t.addToCartForm),o(),r("ngIf",t.showQuantity),o(),r("ngIf",t.hasStock),o(),r("ngIf",t.hasStock)}}var kt=(()=>{class e{handleKeyboardEvent(t){if(!this.featureConfigService?.isEnabled("a11yQuantityOrderTabbing"))return;let n=t.target,i=n.ariaLabel==="Quantity"&&n.tagName==="INPUT";t.key==="Enter"&&i&&t.preventDefault()}constructor(t,n,i,m,s,ft){this.currentProductService=t,this.cd=n,this.activeCartService=i,this.component=m,this.eventService=s,this.productListItemContext=ft,this.showQuantity=!0,this.hasStock=!1,this.inventoryThreshold=!1,this.showInventory$=this.component?.data$.pipe(k(ht=>ht.inventoryDisplay)),this.quantity=1,this.addToCartForm=new J({quantity:new X(1,{updateOn:"blur"})}),this.CartOutlets=Ct,this.iconTypes=ot,this.featureConfigService=O(W,{optional:!0})}ngOnInit(){this.product?(this.productCode=this.product.code??"",this.setStockInfo(this.product),this.cd.markForCheck()):this.productCode?(this.quantity=1,this.hasStock=!0,this.cd.markForCheck()):this.subscription=(this.productListItemContext?this.productListItemContext.product$:this.currentProductService.getProduct()).pipe(b(H)).subscribe(t=>{this.productCode=t.code??"",this.setStockInfo(t),this.cd.markForCheck()})}setStockInfo(t){this.quantity=1,this.addToCartForm.controls.quantity.setValue(1),this.hasStock=t.stock?.stockLevelStatus!=="outOfStock",this.inventoryThreshold=t.stock?.isValueRounded??!1,this.hasStock&&t.stock?.stockLevel&&(this.maxQuantity=t.stock.stockLevel),this.productListItemContext&&(this.showQuantity=!1)}getInventory(){if(this.hasStock){let t=this.maxQuantity?this.maxQuantity.toString():"";return this.inventoryThreshold?t+"+":t}else return""}updateCount(t){this.quantity=t}addToCart(){let t=this.addToCartForm.get("quantity")?.value;!this.productCode||t<=0||(this.pickupOptionCompRef instanceof q&&this.pickupOptionCompRef.instance.intendedPickupLocation$.pipe(_(1)).subscribe(n=>{this.pickupStore=n?.pickupOption==="pickup"?n.name:void 0}),this.activeCartService.getEntries().pipe(_(1)).subscribe(n=>{this.activeCartService.addEntry(this.productCode,t,this.pickupStore),this.eventService.dispatch(this.createCartUiEventAddToCart(this.productCode,t,n.length,this.pickupStore))}))}createCartUiEventAddToCart(t,n,i,m){let s=new mt;return s.productCode=t,s.quantity=n,s.numberOfEntriesBeforeAdd=i,s.pickupStoreName=m,s}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=function(n){return new(n||e)(l(pt),l(Q),l(lt),l(st),l(K),l(ut,8))}}static{this.\u0275cmp=w({type:e,selectors:[["cx-add-to-cart"]],hostBindings:function(n,i){n&1&&T("keydown",function(s){return i.handleKeyboardEvent(s)},!1,D)},inputs:{productCode:"productCode",showQuantity:"showQuantity",options:"options",pickupStore:"pickupStore",product:"product"},decls:1,vars:1,consts:[[3,"formGroup","submit",4,"ngIf"],[3,"submit","formGroup"],["class","quantity",4,"ngIf"],[4,"ngIf"],["type","submit",3,"ngClass","disabled",4,"ngIf"],[1,"quantity"],[1,"cx-counter-stock"],[3,"max","control",4,"ngIf"],[1,"info"],[3,"max","control"],[3,"cxComponentRefChange","cxOutlet","cxComponentRef"],["type","submit",3,"ngClass","disabled"],["class","repeat-icon",4,"ngIf"],[3,"ngClass"],[1,"repeat-icon"],[3,"type"]],template:function(n,i){n&1&&C(0,St,4,4,"form",0),n&2&&r("ngIf",i.productCode)},dependencies:[L,j,Z,z,tt,rt,ct,it,V,$],encapsulation:2,changeDetection:0})}}return e})(),Ht=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=E({type:e})}static{this.\u0275inj=A({providers:[G({cmsComponents:{ProductAddToCartComponent:{component:kt,data:{inventoryDisplay:!1}}}})],imports:[U,et,Y,at,dt,nt]})}}return e})();export{kt as a,Ht as b};
