import{c as Fe,d as Z,e as Ct,f as It}from"./chunk-ZPNTDH77.js";import{$ as Tt,Ca as be,D as xe,E as Te,Ea as ke,Ia as Be,Ja as Ue,L as vt,M as ht,N as yt,Q as _e,Ub as Pe,_ as xt,aa as Ce,b as de,c as j,d as me,e as ue,fa as _t,g as fe,j as G,ka as Ne,l as ge,p as ve,pa as Ie,s as he,x as ye}from"./chunk-ABA734YC.js";import{$d as W,$f as ft,Aa as y,Ac as K,Ae as ct,Bb as Ee,Cb as De,Db as Le,Dd as I,Eb as Ve,Ee as Oe,Fa as _,Fb as p,Ga as C,Gb as se,Ha as We,Hb as m,Hc as R,Ib as Ze,Ie as lt,Je as pt,Lb as ze,Lc as tt,Mb as Ye,Me as pe,N as Me,Nb as Je,Ne as Q,Of as U,Pb as E,Pf as P,Qb as H,Qe as dt,Rc as it,Re as X,Ta as n,Ua as q,Vd as ot,Xb as r,Yb as a,Zb as Ae,Ze as ee,a as He,ac as ce,ag as gt,bb as Qe,cb as f,ce as rt,db as re,df as te,eb as s,ef as mt,gb as ae,gc as Xe,ge as le,gf as ut,i as ne,ja as oe,kb as l,lb as c,ma as L,mb as g,nb as M,oa as Se,ob as S,og as D,pd as nt,pg as $,qb as J,r as we,ra as b,s as Ke,sa as h,sb as k,sc as Re,se as B,ta as Y,tb as F,td as O,ua as x,ue as at,va as v,vc as A,vd as N,wb as V,xe as st,za as w,zc as et}from"./chunk-FDYREMOD.js";var kt=()=>({cxRoute:"forgotPassword"}),Ft=e=>({label:e});function Bt(e,u){e&1&&g(0,"cx-spinner",10)}function Ut(e,u){if(e&1&&(g(0,"cx-form-errors",11),r(1,"cxTranslate")),e&2){let t=F();s("translationParams",H(4,Ft,a(1,2,"loginForm.emailAddress.label")))("control",t.form.get("userId"))}}function Pt(e,u){if(e&1&&g(0,"cx-form-errors",12),e&2){let t=F();s("control",t.form.get("userId"))}}function $t(e,u){if(e&1&&(g(0,"cx-form-errors",11),r(1,"cxTranslate")),e&2){let t=F();s("translationParams",H(4,Ft,a(1,2,"loginForm.password.label")))("control",t.form.get("password"))}}function jt(e,u){if(e&1&&g(0,"cx-form-errors",12),e&2){let t=F();s("control",t.form.get("password"))}}function Gt(e,u){e&1&&(l(0,"abbr",14),r(1,"cxTranslate"),p(2,"*"),c()),e&2&&V("title",a(1,1,"common.required"))}function qt(e,u){e&1&&f(0,Gt,3,3,"abbr",13),e&2&&s("cxFeature","a11yRequiredAsterisks")}var Ht=()=>({cxRoute:"register"}),Kt=()=>({cxRoute:"checkoutLogin"});function Wt(e,u){if(e&1){let t=J();M(0),l(1,"button",3),k("click",function(){_(t);let o=F();return C(o.navigateTo(o.loginAsGuest?"checkoutLogin":"register"))}),p(2),r(3,"cxTranslate"),c(),S()}if(e&2){let t=F();n(),s("ngClass",t.loginAsGuest?"btn-guest":"btn-register"),n(),m(" ",a(3,2,t.loginAsGuest?"loginForm.guestCheckout":"loginForm.register")," ")}}function Qt(e,u){e&1&&(M(0),l(1,"a",5),r(2,"cxUrl"),p(3),r(4,"cxTranslate"),c(),S()),e&2&&(n(),s("routerLink",a(2,2,E(6,Ht))),n(2),se(a(4,4,"loginForm.register")))}function Zt(e,u){e&1&&(M(0),l(1,"a",6),r(2,"cxUrl"),p(3),r(4,"cxTranslate"),c(),S()),e&2&&(n(),s("routerLink",a(2,2,E(6,Kt))),n(2),se(a(4,4,"loginForm.guestCheckout")))}function zt(e,u){if(e&1&&(M(0),f(1,Qt,5,7,"ng-container",4)(2,Zt,5,7,"ng-container",4),S()),e&2){let t=F();n(),s("ngIf",!t.loginAsGuest),n(),s("ngIf",t.loginAsGuest)}}var Yt=e=>({name:e}),wt=()=>({cxRoute:"login"});function Jt(e,u){if(e&1&&(M(0),l(1,"div",2),p(2),r(3,"cxTranslate"),c(),g(4,"cx-page-slot",3),S()),e&2){let t=u.ngIf;n(2),m(" ",Ae(3,1,"miniLogin.userGreeting",H(4,Yt,t.name))," ")}}function Xt(e,u){e&1&&(l(0,"a",4),r(1,"cxUrl"),p(2),r(3,"cxTranslate"),c()),e&2&&(s("routerLink",a(1,2,E(6,wt))),n(2),se(a(3,4,"miniLogin.signInRegister")))}var ei=()=>({cxRoute:"logout"});function ti(e,u){if(e&1&&(M(0),l(1,"div",2),p(2),c(),l(3,"a",3),r(4,"cxUrl"),p(5),r(6,"cxTranslate"),c(),S()),e&2){let t=u.ngIf;n(2),Ze("",t.title,"",t.name,""),n(),s("routerLink",a(4,4,E(8,ei))),n(2),m("",a(6,6,"myAccountV2User.signOut")," ")}}function ii(e,u){e&1&&g(0,"cx-spinner",11)}function ni(e,u){e&1&&(l(0,"p",12),p(1),r(2,"cxTranslate"),c()),e&2&&(n(),m(" ",a(2,1,"formLegend.required")," "))}function oi(e,u){}function ri(e,u){}function ai(e,u){e&1&&(l(0,"abbr",14),r(1,"cxTranslate"),p(2,"*"),c()),e&2&&V("title",a(1,1,"common.required"))}function si(e,u){e&1&&f(0,ai,3,3,"abbr",13),e&2&&s("cxFeature","a11yRequiredAsterisks")}function ci(e,u){e&1&&(l(0,"h3",12),p(1),r(2,"cxTranslate"),c()),e&2&&(n(),m(" ",a(2,1,"verificationTokenDialog.title")," "))}function li(e,u){e&1&&(l(0,"span",12),p(1),r(2,"cxTranslate"),c()),e&2&&(n(),m(" ",a(2,1,"verificationTokenDialog.title")," "))}var pi=["noReceiveCodeLink"],di=["resendLink"],mi=e=>({"disabled-link":e}),ui=e=>({waitTime:e});function fi(e,u){e&1&&g(0,"cx-spinner",19)}function gi(e,u){if(e&1&&(M(0),p(1),r(2,"cxTranslate"),S()),e&2){let t=F();n(),m(" ",Ae(2,1,"verificationTokenForm.sendRateLime",H(4,ui,t.waitTime))," ")}}var $e=(()=>{class e{constructor(t,i,o){this.auth=t,this.globalMessage=i,this.winRef=o,this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(L(d=>{let T=this.winRef.nativeWindow?.history?.state?.newUid;T&&this.form.patchValue({userId:T}),d===!0?this.form.disable():this.form.enable()})),this.form=new fe({userId:new G("",[j.required,Pe.emailValidator]),password:new G("",j.required)})}login(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0),we(this.auth.loginWithCredentials(this.form.value.userId.toLowerCase(),this.form.value.password)).pipe(Se(this.auth.isUserLoggedIn()),L(([t,i])=>this.onSuccess(i))).subscribe()}onSuccess(t){t&&(this.globalMessage.remove(pe.MSG_TYPE_ERROR),this.form.reset()),this.busy$.next(!1)}static{this.\u0275fac=function(i){return new(i||e)(x(B),x(Q),x(W))}}static{this.\u0275prov=b({token:e,factory:e.\u0275fac})}}return e})(),vi=(()=>{class e{constructor(t){this.service=t,this.form=this.service.form,this.isUpdating$=this.service.isUpdating$,this.style=!0}onSubmit(){this.service.login()}static{this.\u0275fac=function(i){return new(i||e)(q($e))}}static{this.\u0275cmp=w({type:e,selectors:[["cx-login-form"]],hostVars:2,hostBindings:function(i,o){i&2&&ae("user-form",o.style)},decls:29,vars:34,consts:[["requiredAsterisk",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","type","email","formControlName","userId",1,"form-control",3,"placeholder"],[3,"translationParams","control",4,"cxFeature"],[3,"control",4,"cxFeature"],["required","true","type","password","formControlName","password","cxPasswordVisibilitySwitch","",1,"form-control",3,"placeholder"],[1,"btn-link",3,"routerLink"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"overlay"],[3,"translationParams","control"],[3,"control"],["class","text-decoration-none",3,"title",4,"cxFeature"],[1,"text-decoration-none",3,"title"]],template:function(i,o){if(i&1){let d=J();f(0,Bt,1,0,"cx-spinner",1),r(1,"async"),l(2,"form",2),k("ngSubmit",function(){return _(d),C(o.onSubmit())}),l(3,"label")(4,"span",3),p(5),r(6,"cxTranslate"),c(),g(7,"input",4),r(8,"cxTranslate"),f(9,Ut,2,6,"cx-form-errors",5)(10,Pt,1,1,"cx-form-errors",6),c(),l(11,"label")(12,"span",3),p(13),r(14,"cxTranslate"),c(),g(15,"input",7),r(16,"cxTranslate"),r(17,"cxTranslate"),f(18,$t,2,6,"cx-form-errors",5)(19,jt,1,1,"cx-form-errors",6),c(),l(20,"a",8),r(21,"cxUrl"),p(22),r(23,"cxTranslate"),c(),l(24,"button",9),p(25),r(26,"cxTranslate"),c()(),f(27,qt,1,1,"ng-template",null,0,ce)}i&2&&(s("ngIf",a(1,15,o.isUpdating$)),n(2),s("formGroup",o.form),n(3),m(" ",a(6,17,"loginForm.emailAddress.label")," "),n(2),V("placeholder",a(8,19,"loginForm.emailAddress.placeholder")),n(2),s("cxFeature","formErrorsDescriptiveMessages"),n(),s("cxFeature","!formErrorsDescriptiveMessages"),n(3),m(" ",a(14,21,"loginForm.password.label")," "),n(2),V("placeholder",a(16,23,"loginForm.password.placeholder")),re("aria-label",a(17,25,"loginForm.password.placeholder")),n(3),s("cxFeature","formErrorsDescriptiveMessages"),n(),s("cxFeature","!formErrorsDescriptiveMessages"),n(),s("routerLink",a(21,27,E(33,kt))),n(2),m(" ",a(23,29,"loginForm.forgotPassword")," "),n(2),s("disabled",o.form.disabled),n(),m(" ",a(26,31,"loginForm.signIn")," "))},dependencies:[A,ge,de,me,ue,ye,ve,he,O,be,Ce,Be,ee,K,U,D],encapsulation:2,changeDetection:0})}}return e})(),hi=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I({cmsComponents:{ReturningCustomerLoginComponent:{component:vi,guards:[X],providers:[{provide:$e,useClass:$e,deps:[B,Q,W]}]}}})],imports:[R,xe,Te,N,P,$,ke,Ie,Ue,te]})}}return e})(),yi=(()=>{class e{constructor(t){this.activatedRoute=t,this.loginAsGuest=!1,this.routingService=v(le,{optional:!0})}ngOnInit(){this.loginAsGuest=this.activatedRoute.snapshot.queryParams.forced}navigateTo(t){this.routingService?.go({cxRoute:t})}static{this.\u0275fac=function(i){return new(i||e)(q(nt))}}static{this.\u0275cmp=w({type:e,selectors:[["cx-login-register"]],decls:6,vars:5,consts:[[1,"register"],[1,"cx-section-title"],[4,"cxFeature"],[1,"btn","btn-block","btn-secondary",3,"click","ngClass"],[4,"ngIf"],[1,"btn","btn-block","btn-secondary","btn-register",3,"routerLink"],[1,"btn","btn-block","btn-secondary","btn-guest",3,"routerLink"]],template:function(i,o){i&1&&(l(0,"div",0)(1,"p",1),p(2),r(3,"cxTranslate"),c(),f(4,Wt,4,4,"ng-container",2)(5,zt,3,2,"ng-container",2),c()),i&2&&(n(2),m(" ",a(3,3,"loginForm.dontHaveAccount")," "),n(2),s("cxFeature","a11yUseButtonsForBtnLinks"),n(),s("cxFeature","!a11yUseButtonsForBtnLinks"))},dependencies:[Re,A,O,ee,U,D],encapsulation:2})}}return e})(),xi=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I({cmsComponents:{ReturningCustomerRegisterComponent:{component:yi,guards:[X]}}})],imports:[R,N,P,Ne,$,te]})}}return e})(),Mt=(()=>{class e{constructor(t,i){this.auth=t,this.userAccount=i,mt("a11yMyAccountLinkOutline")}ngOnInit(){this.user$=this.auth.isUserLoggedIn().pipe(oe(t=>t?this.userAccount.get():Ke(void 0)))}static{this.\u0275fac=function(i){return new(i||e)(q(B),q(Fe))}}static{this.\u0275cmp=w({type:e,selectors:[["cx-login"]],decls:4,vars:4,consts:[["login",""],[4,"ngIf","ngIfElse"],[1,"cx-login-greet"],["id","account-nav","position","HeaderLinks"],["role","link",3,"routerLink"]],template:function(i,o){if(i&1&&(f(0,Jt,5,6,"ng-container",1),r(1,"async"),f(2,Xt,4,7,"ng-template",null,0,ce)),i&2){let d=Ve(3);s("ngIf",a(1,2,o.user$))("ngIfElse",d)}},dependencies:[A,O,_t,K,U,D],encapsulation:2})}}return e})(),Ti=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I({cmsComponents:{LoginComponent:{component:Mt}}})],imports:[R,N,P,Ne,$]})}}return e})(),_i=(()=>{class e extends Mt{static{this.\u0275fac=(()=>{let t;return function(o){return(t||(t=We(e)))(o||e)}})()}static{this.\u0275cmp=w({type:e,selectors:[["cx-my-account-v2-user"]],features:[Qe],decls:3,vars:3,consts:[[1,"cx-my-account-v2-user"],[4,"ngIf"],[1,"cx-name"],[1,"cx-sign-out",3,"routerLink"]],template:function(i,o){i&1&&(l(0,"div",0),f(1,ti,7,9,"ng-container",1),r(2,"async"),c()),i&2&&(n(),s("ngIf",a(2,1,o.user$)))},dependencies:[A,O,K,U,D],encapsulation:2})}}return e})(),Ci=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I({cmsComponents:{MyAccountViewUserComponent:{component:_i,guards:[dt]}}})],imports:[R,N,P,$]})}}return e})(),St="LOGIN",Ii=(()=>{class e{constructor(){this.routingService=v(le),this.verificationTokenFacade=v(Z),this.winRef=v(W),this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(L(t=>{let i=this.winRef.nativeWindow?.history?.state?.newUid;i&&this.form.patchValue({userId:i}),t===!0?this.form.disable():this.form.enable()})),this.form=new fe({userId:new G("",[j.required,Pe.emailValidator]),password:new G("",j.required)}),this.style=!0}onSubmit(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0);let t=this.collectDataFromLoginForm();this.verificationTokenFacade.createVerificationToken(t).subscribe({next:i=>this.goToVerificationTokenForm(i,t),error:()=>this.busy$.next(!1),complete:()=>this.onCreateVerificationTokenComplete()})}goToVerificationTokenForm(t,i){this.routingService.go({cxRoute:"verifyToken"},{state:{loginId:i.loginId,password:i.password,tokenId:t.tokenId,expiresIn:t.expiresIn}})}onCreateVerificationTokenComplete(){this.form.reset(),this.busy$.next(!1)}collectDataFromLoginForm(){return{loginId:this.form.value.userId.toLowerCase(),password:this.form.value.password,purpose:St}}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=w({type:e,selectors:[["cx-otp-login-form"]],hostVars:2,hostBindings:function(i,o){i&2&&ae("user-form",o.style)},decls:30,vars:35,consts:[["requiredAsterisk",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],["class","form-legend",4,"cxFeature"],[1,"label-content"],[3,"ngTemplateOutlet"],["required","true","type","email","formControlName","userId",1,"form-control",3,"placeholder"],[3,"control"],["required","true","type","password","formControlName","password","cxPasswordVisibilitySwitch","",1,"form-control",3,"placeholder"],[1,"btn-link",3,"routerLink"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"overlay"],[1,"form-legend"],["class","text-decoration-none",3,"title",4,"cxFeature"],[1,"text-decoration-none",3,"title"]],template:function(i,o){if(i&1){let d=J();f(0,ii,1,0,"cx-spinner",1),r(1,"async"),l(2,"form",2),k("ngSubmit",function(){return _(d),C(o.onSubmit())}),f(3,ni,3,3,"p",3),l(4,"label")(5,"span",4),p(6),r(7,"cxTranslate"),f(8,oi,0,0,"ng-template",5),c(),g(9,"input",6),r(10,"cxTranslate"),g(11,"cx-form-errors",7),c(),l(12,"label")(13,"span",4),p(14),r(15,"cxTranslate"),f(16,ri,0,0,"ng-template",5),c(),g(17,"input",8),r(18,"cxTranslate"),r(19,"cxTranslate"),g(20,"cx-form-errors",7),c(),l(21,"a",9),r(22,"cxUrl"),p(23),r(24,"cxTranslate"),c(),l(25,"button",10),p(26),r(27,"cxTranslate"),c()(),f(28,si,1,1,"ng-template",null,0,ce)}if(i&2){let d=Ve(29);s("ngIf",a(1,16,o.isUpdating$)),n(2),s("formGroup",o.form),n(),s("cxFeature","a11yRequiredAsterisks"),n(3),m(" ",a(7,18,"loginForm.emailAddress.label")," "),n(2),s("ngTemplateOutlet",d),n(),V("placeholder",a(10,20,"loginForm.emailAddress.placeholder")),n(2),s("control",o.form.get("userId")),n(3),m(" ",a(15,22,"loginForm.password.label")," "),n(2),s("ngTemplateOutlet",d),n(),V("placeholder",a(18,24,"loginForm.password.placeholder")),re("aria-label",a(19,26,"loginForm.password.placeholder")),n(3),s("control",o.form.get("password")),n(),s("routerLink",a(22,28,E(34,kt))),n(2),m(" ",a(24,30,"loginForm.forgotPassword")," "),n(2),s("disabled",o.form.disabled),n(),m(" ",a(27,32,"loginForm.signIn")," ")}},dependencies:[A,et,ge,de,me,ue,ye,ve,he,O,be,Ce,Be,ee,K,U,D],encapsulation:2,changeDetection:0})}}return e})(),bi=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I({cmsComponents:{ReturningCustomerOTPLoginComponent:{component:Ii,guards:[X]}}})],imports:[R,xe,Te,N,P,$,ke,Ie,Ue,te]})}}return e})(),ki=(()=>{class e{constructor(t){this.launchDialogService=t,this.VERIFICATION_TOKEN_DIALOG_ACTION=Ct,this.focusConfig={trap:!0,block:!0,autofocus:!0,focusOnEscape:!0}}closeModal(t){this.launchDialogService.closeDialog(t)}static{this.\u0275fac=function(i){return new(i||e)(q(_e))}}static{this.\u0275cmp=w({type:e,selectors:[["cx-verification-token-dialog"]],decls:28,vars:21,consts:[["role","dialog","aria-labelledby","verification-token-dialog-title",1,"cx-verification-token-dialog","cx-modal-container","cx-asm-dialog",3,"esc","cxFocus"],[1,"cx-modal-content"],[1,"cx-dialog-header","modal-header"],[1,"info-icon"],["type","INFO"],["id","verification-token-dialog-title","class","title modal-title",4,"cxFeature"],[1,"spliter"],[1,"cx-dialog-body","modal-body"],[1,"cx-dialog-row"],[1,"cx-dialog-item"],[1,"cx-dialog-footer","modal-footer"],["type","button",1,"btn","btn-primary",3,"click"],["id","verification-token-dialog-title",1,"title","modal-title"]],template:function(i,o){i&1&&(l(0,"div",0),k("esc",function(){return o.closeModal(o.VERIFICATION_TOKEN_DIALOG_ACTION.OK)}),l(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),g(5,"cx-icon",4),c(),f(6,ci,3,3,"h3",5)(7,li,3,3,"span",5),c()(),g(8,"hr",6),l(9,"div",7)(10,"div",8)(11,"div",9),p(12),r(13,"cxTranslate"),c(),l(14,"div",9),p(15),r(16,"cxTranslate"),c(),l(17,"div",9),p(18),r(19,"cxTranslate"),c(),l(20,"div",9),p(21),r(22,"cxTranslate"),c()()(),l(23,"div",10)(24,"button",11),r(25,"cxTranslate"),k("click",function(){return o.closeModal(o.VERIFICATION_TOKEN_DIALOG_ACTION.OK)}),p(26),r(27,"cxTranslate"),c()()()()),i&2&&(s("cxFocus",o.focusConfig),n(6),s("cxFeature","a11yDialogsHeading"),n(),s("cxFeature","!a11yDialogsHeading"),n(5),m(" ",a(13,9,"verificationTokenDialog.noReceiveCode")," "),n(3),m(" ",a(16,11,"verificationTokenDialog.contentLine1")," "),n(3),m(" ",a(19,13,"verificationTokenDialog.contentLine2")," "),n(3),m(" ",a(22,15,"verificationTokenDialog.contentLine3")," "),n(3),re("aria-label",a(25,17,"verificationTokenDialog.ok")),n(2),m(" ",a(27,19,"verificationTokenDialog.close")," "))},dependencies:[vt,xt,ee,D],encapsulation:2})}}return e})(),Fi={launch:{ACCOUNT_VERIFICATION_TOKEN:{inlineRoot:!0,component:ki,dialogType:yt.DIALOG}}},wi=1e4,je=(()=>{class e{constructor(){this.globalMessage=v(Q),this.verificationTokenFacade=v(Z),this.auth=v(B),this.busy$=new ne(!1),this.isUpdating$=this.busy$.pipe(L(t=>{t===!0?this.form.disable():this.form.enable()})),this.form=new fe({tokenId:new G("",[j.required]),tokenCode:new G("",[j.required])})}login(){if(!this.form.valid){this.form.markAllAsTouched();return}this.busy$.next(!0),we(this.auth.otpLoginWithCredentials(this.form.value.tokenId,this.form.value.tokenCode)).pipe(Se(this.auth.isUserLoggedIn()),L(([t,i])=>this.onSuccess(i))).subscribe()}displayMessage(t,i){this.globalMessage.add({key:t,params:i},pe.MSG_TYPE_CONFIRMATION,wi)}createVerificationToken(t,i,o){return this.verificationTokenFacade.createVerificationToken({loginId:t,password:i,purpose:o})}onSuccess(t){t&&(this.globalMessage.remove(pe.MSG_TYPE_ERROR),this.form.reset()),this.busy$.next(!1)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=b({token:e,factory:e.\u0275fac})}}return e})(),Mi=(()=>{class e{constructor(){this.service=v(je),this.launchDialogService=v(_e),this.cdr=v(Xe),this.routingService=v(le),this.waitTime=60,this.form=this.service.form,this.isUpdating$=this.service.isUpdating$,this.style=!0,this.isResendDisabled=!0}ngOnInit(){history.state&&(this.tokenId=history.state.tokenId,this.password=history.state.password,this.target=history.state.loginId,history.pushState({tokenId:"",password:"",loginId:""},"verifyToken"),!this.target||!this.password||!this.tokenId?(this.service.displayMessage("verificationTokenForm.needInputCredentials",{}),this.routingService.go(["/login"])):(this.startWaitTimeInterval(),this.service.displayMessage("verificationTokenForm.createVerificationToken",{target:this.target})))}onSubmit(){this.service.login()}resendOTP(){this.isResendDisabled=!0,this.resendLink.nativeElement.tabIndex=-1,this.resendLink.nativeElement.blur(),this.waitTime=60,this.startWaitTimeInterval(),this.service.createVerificationToken(this.target,this.password,St).subscribe({next:t=>this.tokenId=t.tokenId,complete:()=>this.service.displayMessage("verificationTokenForm.createVerificationToken",{target:this.target})})}startWaitTimeInterval(){let t=setInterval(()=>{this.waitTime--,this.cdr.detectChanges(),this.waitTime<=0&&(clearInterval(t),this.isResendDisabled=!1,this.resendLink.nativeElement.tabIndex=0,this.cdr.detectChanges())},1e3)}openInfoDailog(){this.launchDialogService.openDialogAndSubscribe("ACCOUNT_VERIFICATION_TOKEN",this.element)}onOpenInfoDailogKeyDown(t){(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.openInfoDailog())}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=w({type:e,selectors:[["cx-verification-token-form"]],viewQuery:function(i,o){if(i&1&&(Ee(pi,5),Ee(di,5)),i&2){let d;De(d=Le())&&(o.element=d.first),De(d=Le())&&(o.resendLink=d.first)}},hostVars:2,hostBindings:function(i,o){i&2&&ae("user-form",o.style)},decls:35,vars:36,consts:[["resendLink",""],["noReceiveCodeLink",""],["class","overlay",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"label-content"],["required","true","formControlName","tokenCode","aria-describedby","tokenInputHint",1,"form-control",3,"placeholder"],[3,"control"],["id","tokenInputHint",1,"cx-visually-hidden"],["type","hidden","formControlName","tokenId",3,"ngModelChange","ngModel"],[1,"resend-link-text"],[1,"left-text"],["role","timer","aria-live","polite","aria-atomic","true"],["role","button","tabindex","-1",1,"btn-link",3,"keydown.enter","keydown.space","click","ngClass"],[4,"ngIf"],[1,"right-text"],["role","button","tabindex","0",1,"btn-link",3,"keydown","click"],[1,"verify-container"],["type","submit",1,"btn","btn-block","btn-primary",3,"disabled"],[1,"btn","btn-block","btn-secondary","btn-register",3,"routerLink"],[1,"overlay"]],template:function(i,o){if(i&1){let d=J();f(0,fi,1,0,"cx-spinner",2),r(1,"async"),l(2,"form",3),k("ngSubmit",function(){return _(d),C(o.onSubmit())}),l(3,"label")(4,"span",4),p(5),r(6,"cxTranslate"),c(),g(7,"input",5),r(8,"cxTranslate"),g(9,"cx-form-errors",6),c(),l(10,"span",7),p(11),r(12,"cxTranslate"),c(),l(13,"input",8),Je("ngModelChange",function(z){return _(d),Ye(o.tokenId,z)||(o.tokenId=z),C(z)}),c(),l(14,"div",9)(15,"div",10)(16,"span",11)(17,"a",12,0),k("keydown.enter",function(){return _(d),C(o.resendOTP())})("keydown.space",function(){return _(d),C(o.resendOTP())})("click",function(){return _(d),C(o.resendOTP())}),p(19),r(20,"cxTranslate"),c(),f(21,gi,3,6,"ng-container",13),c()(),l(22,"div",14)(23,"a",15,1),k("keydown",function(z){return _(d),C(o.onOpenInfoDailogKeyDown(z))})("click",function(){return _(d),C(o.openInfoDailog())}),p(25),r(26,"cxTranslate"),c()()(),l(27,"div",16)(28,"button",17),p(29),r(30,"cxTranslate"),c(),l(31,"button",18),r(32,"cxUrl"),p(33),r(34,"cxTranslate"),c()()()}i&2&&(s("ngIf",a(1,15,o.isUpdating$)),n(2),s("formGroup",o.form),n(3),m(" ",a(6,17,"verificationTokenForm.verificationCode.label")," "),n(2),s("placeholder",a(8,19,"verificationTokenForm.verificationCode.placeholder")),n(2),s("control",o.form.get("tokenCode")),n(2),m(" ",a(12,21,"verificationTokenForm.tokenInputHint")," "),n(2),ze("ngModel",o.tokenId),n(4),s("ngClass",H(33,mi,o.isResendDisabled)),n(2),m(" ",a(20,23,"verificationTokenForm.resend")," "),n(2),s("ngIf",o.isResendDisabled),n(4),m(" ",a(26,25,"verificationTokenForm.noReceiveCode")," "),n(3),s("disabled",o.form.disabled),n(),m(" ",a(30,27,"verificationTokenForm.verify")," "),n(2),s("routerLink",a(32,29,E(35,wt))),n(2),m(" ",a(34,31,"verificationTokenForm.back")," "))},dependencies:[Re,A,ge,de,me,ue,ye,ve,he,O,be,Ce,K,U,D],encapsulation:2,changeDetection:0})}}return e})(),Si=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I({cmsComponents:{VerifyOTPTokenComponent:{component:Mi,guards:[X],providers:[{provide:je,useClass:je,deps:[B,Q,Z,W]}]}}}),I(Fi)],imports:[R,xe,ht,Te,N,P,Tt,$,ke,Ie,te]})}}return e})(),Et=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({imports:[Ti,hi,Si,xi,Ci,bi]})}}return e})();var Vt=new Y("UserAccountNormalizer"),ln=new Y("UserAccountSerializer"),At=new Y("VerificationTokenNormalizer"),Rt=new Y("LoginFormSerializer"),ie=class{},qe=(()=>{class e{constructor(t){this.adapter=t}get(t){return this.adapter.load(t)}createVerificationToken(t){return this.adapter.createVerificationToken(t)}static{this.\u0275fac=function(i){return new(i||e)(x(ie))}}static{this.\u0275prov=b({token:e,factory:e.\u0275fac})}}return e})(),Dt=(()=>{class e{constructor(t,i,o){this.userAccountConnector=t,this.userIdService=i,this.query=o,this.userQuery=this.query.create(()=>this.userIdService.takeUserId(!0).pipe(oe(d=>this.userAccountConnector.get(d))),{reloadOn:[It],resetOn:[pt,lt]})}getById(t){return this.userAccountConnector.get(t)}get(){return this.userQuery.get()}static{this.\u0275fac=function(i){return new(i||e)(x(qe),x(ot),x(gt))}}static{this.\u0275prov=b({token:e,factory:e.\u0275fac})}}return e})(),Lt=(()=>{class e{constructor(){this.connector=v(qe),this.command=v(ft),this.createVerificationTokenCommand=this.command.create(({verificationTokenCreation:t})=>this.connector.createVerificationToken(t))}createVerificationToken(t){return this.createVerificationTokenCommand.execute({verificationTokenCreation:t})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=b({token:e,factory:e.\u0275fac})}}return e})(),Ei=[Dt,{provide:Fe,useExisting:Dt},Lt,{provide:Z,useExisting:Lt}],Ot=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[qe,...Ei]})}}return e})();var Di={backend:{occ:{endpoints:{user:"users/${userId}",createVerificationToken:"users/anonymous/verificationToken"}}}},Li={"Content-Type":"application/json"},Vi=(()=>{class e{constructor(t,i,o){this.http=t,this.occEndpoints=i,this.converter=o,this.logger=v(rt)}load(t){let i=this.occEndpoints.buildUrl("user",{urlParams:{userId:t}});return this.http.get(i).pipe(Me(o=>{throw Oe(o,this.logger)}),this.converter.pipeable(Vt))}createVerificationToken(t){let i=this.occEndpoints.buildUrl("createVerificationToken"),o=st.createHeader(at,!0,new tt(He({},Li)));return t=this.converter.convert(t,Rt),this.http.post(i,t,{headers:o}).pipe(Me(d=>{throw Oe(d,this.logger)}),this.converter.pipeable(At))}static{this.\u0275fac=function(i){return new(i||e)(x(it),x(ct),x(ut))}}static{this.\u0275prov=b({token:e,factory:e.\u0275fac})}}return e})(),Nt=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({providers:[I(Di),{provide:ie,useClass:Vi}]})}}return e})();var bn=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=h({imports:[Ot,Nt,Et]})}}return e})();export{bn as UserAccountModule};
